<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - Colegio Bethel</title>

    <!-- Google Fonts Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;700&display=swap" rel="stylesheet">

    <style>
        /* Reset b√°sico */
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body { font-family: 'Poppins', sans-serif; background-color: #fff; }

        .header-logo { width: 100%; background-color: #F7F7F7; display: flex; justify-content: center; align-items: center; padding: 40px 0; }
        .header-logo img { max-width: 200px; height: auto; }

        .welcome-section { width: 100%; background-color: #3FB156; display: flex; flex-wrap: wrap; padding: 60px 10%; color: white; }
        .welcome-left { flex: 1; display: flex; justify-content: center; align-items: center; min-width: 300px; }
        .welcome-left img { max-width: 100%; height: auto; }
        .welcome-right { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px; min-width: 300px; }

        .welcome-right h1 {
            font-weight: 700;
            font-size: 85px;
            margin-bottom: 5px;
        }

        .welcome-right h2.subtitle {
            font-weight: 400;
            font-size: 28px;
            margin-bottom: 25px;
        }

        .welcome-right p {
    font-weight: 400;
    font-size: 16px; /* üîπ
    line-height: 1.7;
    margin-bottom: 15px; /* üîπ
    max-width: 650px;
}

        .welcome-right .btn-continuar {
            background-color: white;
            color: #3FB156;
            font-weight: 700;
            font-size: 16px;
            border: none;
            border-radius: 22px;
            cursor: pointer;
            width: 225px;
            height: 44px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* .divider { width: 100%; height: 1px; background-color: #3FB156; margin: 15px 0; } */

        .grupo-trabajadores { background-color: #EFEFEF; border-radius: 26px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin: 50px auto; padding: 20px; max-width: 1000px; }
        .grupo-trabajadores h2 { font-weight: 700; font-size: 36px; color: #333333; text-align: center; margin-bottom: 15px; }

        .tabla-trabajadores { width: 100%; border-collapse: collapse; }
        .tabla-trabajadores thead { background-color: #3FB056; color: white; }
        .tabla-trabajadores th, .tabla-trabajadores td { text-align: center; padding: 12px; font-weight: 400; font-size: 14px; }
        .tabla-trabajadores tbody tr:nth-child(even) { background-color: #f5f5f5; }

        .btn-enviar { background-color: #3FB056; color: white; border: none; border-radius: 8px; padding: 6px 12px; cursor: pointer; font-weight: 700; }

        /* Modal */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: #fff; margin: 10% auto; padding: 30px; border-radius: 25px; width: 90%; max-width: 500px; font-family: 'Poppins', sans-serif; position: relative; }

        .modal-content h2 { color: #3FB056; font-weight: 700; font-size: 24px; text-align: center; margin-bottom: 20px; }
        .modal-content label { display: block; margin: 10px 0 5px; font-weight: 500; }
        .modal-content input, .modal-content textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; margin-bottom: 15px; font-family: 'Poppins', sans-serif; font-size: 14px; }
        .modal-content button { background-color: #3FB056; color: white; border: none; border-radius: 8px; padding: 10px 20px; font-weight: 700; font-size: 16px; cursor: pointer; width: 100%; }

        .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close:hover { color: #000; }

        .cargando { display: none; text-align: center; font-weight: 700; color: #3FB056; margin-bottom: 10px; }

        @media (max-width: 768px) {
            .welcome-section { flex-direction: column; padding: 40px 5%; }
            .welcome-right h1 { font-size: 50px; }
            .welcome-right h2.subtitle { font-size: 20px; }
            .welcome-right .btn-continuar { width: 200px; height: 40px; }
            .grupo-trabajadores h2 { font-size: 28px; }
            .tabla-trabajadores th, .tabla-trabajadores td { font-size: 12px; }
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>

<div class="header-logo">
    <img th:src="@{/logohome.png}" alt="Logo Colegio Bethel">
</div>

<div class="welcome-section">
    <div class="welcome-left">
        <img th:src="@{/emailsillustration.png}" alt="Illustration">
    </div>

    <div class="welcome-right">
        <h1>Bienvenido</h1>
        <h2 class="subtitle">¬°Hola, estudiante Bethel!</h2>

        <p>
            Este espacio est√° dise√±ado para que puedan comunicarse directamente con los docentes y el equipo administrativo.
            A trav√©s de esta plataforma podr√°s enviar mensajes relacionados con tus clases, actividades acad√©micas o inquietudes personales del √°mbito escolar.
        </p>

        <p style="font-weight:600; font-size:13px; color:#e8f5e9; margin-top:10px;">
            <strong>Recuerda que este buz√≥n busca fortalecer el di√°logo respetuoso y la confianza entre estudiantes y la instituci√≥n.</strong>
        </p>

        <button class="btn-continuar">Continuar</button>
    </div>
</div>



<!-- NUEVO T√çTULO -->
<h2 style="text-align:center; font-size:48px; color:#3FB056; margin-top:40px; font-weight:800;">Directorio</h2>


<!-- TABLA DE DOCENTES -->
<div th:each="grupo : ${docentesPorMateriaAttribute}">
    <div class="grupo-trabajadores">
        <h2 th:text="${grupo.key}"></h2>
        <table class="tabla-trabajadores">
            <thead>
            <tr>
                <th>Nombres</th>
                <th>Email</th>
                <th>Enviar mensaje</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="trabajador : ${grupo.value}">
                <td th:text="${trabajador.nombres}"></td>
                <td th:text="${trabajador.correo}"></td>
                <td><button class="btn-enviar">Enviar mensaje</button></td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- TABLA DE NO DOCENTES -->
<div th:each="grupo : ${noDocentesPorCargoAttribute}">
    <div class="grupo-trabajadores">
        <h2 th:text="${grupo.key}"></h2>
        <table class="tabla-trabajadores">
            <thead>
            <tr>
                <th>Nombres</th>
                <th>Email</th>
                <th>Enviar mensaje</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="trabajador : ${grupo.value}">
                <td th:text="${trabajador.nombres}"></td>
                <td th:text="${trabajador.correo}"></td>
                <td><button class="btn-enviar">Enviar mensaje</button></td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Modal (script intacto) -->
<div id="modalMensaje" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Enviar Mensaje</h2>
        <div class="cargando" id="cargando">Enviando mensaje...</div>
        <form id="formMensaje">
            <label for="nombreRemitente">Nombre:</label>
            <input type="text" id="nombreRemitente" name="nombreRemitente" required>
            <input type="hidden" id="nombreTrabajadorHidden" name="nombreTrabajador">

            <label for="asunto">Asunto:</label>
            <input type="text" id="asunto" name="asunto" required>

            <label for="emailDestinatario">Email Destinatario:</label>
            <input type="email" id="emailDestinatario" name="emailDestinatario" readonly>

            <label for="mensaje">Mensaje:</label>
            <textarea id="mensaje" name="mensaje" rows="5" required></textarea>

            <button type="submit" class="btn-enviar">Enviar</button>
        </form>
    </div>
</div>


<script th:inline="none">
    const modal = document.getElementById("modalMensaje");
    const spanClose = document.getElementsByClassName("close")[0];
    const emailDestinatarioInput = document.getElementById("emailDestinatario");
    const cargando = document.getElementById("cargando");

    // Abrir el modal con los datos del destinatario
    document.querySelectorAll(".btn-enviar").forEach(button => {
      button.addEventListener("click", function() {
        const fila = button.closest("tr");
        const email = fila.querySelectorAll("td")[1].textContent;
        const nombreTrabajador = fila.querySelectorAll("td")[0].textContent;

        emailDestinatarioInput.value = email;
        document.getElementById("nombreTrabajadorHidden").value = nombreTrabajador;
        modal.style.display = "block";
      });
    });

    // Cerrar modal
    spanClose.onclick = function() { modal.style.display = "none"; };
    window.onclick = function(event) { if (event.target == modal) modal.style.display = "none"; };

    // Env√≠o del mensaje con fetch en formato JSON
    document.getElementById("formMensaje").addEventListener("submit", async function(e) {
      e.preventDefault();

      cargando.style.display = "block";

      // Capturar datos del formulario
      const mensaje = {
        nombreRemitente: document.getElementById("nombreRemitente").value,
        nombreTrabajador: document.getElementById("nombreTrabajadorHidden").value,
        asunto: document.getElementById("asunto").value,
        emailDestinatario: document.getElementById("emailDestinatario").value,
        mensaje: document.getElementById("mensaje").value
      };

      try {
        const response = await fetch("/enviarMensaje", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(mensaje)
        });

        const result = await response.json();
        cargando.style.display = "none";

        // Mostrar resultados
        if (result.contieneGroseria) {
          Swal.fire({
            icon: "error",
            title: "Mensaje no enviado",
            text: result.message
          });
        } else if (response.ok) {
          Swal.fire({
            icon: "success",
            title: "Mensaje enviado",
            text: result.message
          });
          modal.style.display = "none";
          this.reset();
        } else {
          Swal.fire({
            icon: "error",
            title: "Error",
            text: result.message || "Hubo un problema al enviar el mensaje."
          });
        }
      } catch (error) {
        cargando.style.display = "none";
        Swal.fire({
          icon: "error",
          title: "Error de conexi√≥n",
          text: "No se pudo conectar con el servidor."
        });
        console.error("Error:", error);
      }
    });
</script>





</body>

</html>